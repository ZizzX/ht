{"version":3,"sources":["bem-blocks/form.js","server/index.js","01_main.js"],"names":["window","addEventListener","$form","document","querySelector","$nights","$nightsTo","$departCity","$country","$tourTableBody","$tourTableHead","$tourTitle","compareFn","a","b","price","inputAddError","target","message","value","setAttribute","classList","add","removeErrorClass","elem","remove","event","length","e","preventDefault","formData","Object","fromEntries","FormData","entries","departCity","country","date","nights","nightsTo","async","res","fetch","json","getData","then","data","sort","tours","selectedCity","options","selectedIndex","innerText","selectedCountry","localDate","Date","toLocaleDateString","year","month","day","replace","trim","innerHTML","forEach","tour","hotelName","currency","catch","err","Error","name","finally","reset","maxDate","changeDatePickerRange","minDate","days","getDate","getMillisecunds","millisec","t","now","getMonth","getFullYear","getZero","num","setMaxDate","selector","getElementById","setMinDate"],"mappings":"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","file":"../components/main.min.js","sourcesContent":["","window.addEventListener(\"DOMContentLoaded\", () => {\r\n  const $form = document.querySelector(\"#form\");\r\n  const $nights = $form.querySelector(\"#nights\");\r\n  const $nightsTo = $form.querySelector(\"#nights-to\");\r\n  const $departCity = $form.querySelector(\"#depart-city\");\r\n  const $country = $form.querySelector(\"#country\");\r\n  const $tourTableBody = document.querySelector(\"#tourTableBody\");\r\n  const $tourTableHead = document.querySelector(\".tour-table thead\");\r\n  const $tourTitle = document.querySelector(\".tours__title\");\r\n\r\n  const URL = \"https://ht.kz/test/searchPartner1\";\r\n\r\n  const getData = async ({\r\n    departCity,\r\n    country,\r\n    date,\r\n    nights,\r\n    nightsTo,\r\n  } = {}) => {\r\n    const res = await fetch(\r\n      `${URL}?departCity=${departCity}&country=${country}&date=${date}&nights=${nights}&nightsTo=${nightsTo}`\r\n    );\r\n\r\n    return await res.json();\r\n  };\r\n\r\n  $nights.addEventListener(\"input\", (event) => {\r\n    const target = event.target;\r\n    if ($nightsTo.value.length > 0 && +$nightsTo.value <= +target.value) {\r\n      inputAddError(target, \"Больше чем до\");\r\n    } else if ($nightsTo.value > target.value) {\r\n      removeErrorClass(target);\r\n    }\r\n  });\r\n\r\n  $nightsTo.addEventListener(\"change\", (event) => {\r\n    const target = event.target;\r\n    if ($nights.value.length > 0 && +$nights.value >= +target.value) {\r\n      inputAddError(target, \"Меньше чем от\");\r\n    } else if (target.value > $nights.value) {\r\n      removeErrorClass(target);\r\n    }\r\n  });\r\n\r\n  /* FORM GET */\r\n  $form.addEventListener(\"submit\", (e) => {\r\n    e.preventDefault();\r\n\r\n    const formData = Object.fromEntries(new FormData(e.target).entries());\r\n    const { departCity, country, date, nights, nightsTo } = formData;\r\n\r\n    getData({ departCity, country, date, nights, nightsTo })\r\n      .then((data) => {\r\n        const tours = data.tours;\r\n        const sort = tours.sort(compareFn);\r\n\r\n        let selectedCity =\r\n          $departCity[$departCity.options.selectedIndex].innerText;\r\n        let selectedCountry =\r\n          $country[$country.options.selectedIndex].innerText;\r\n        let localDate = new Date(date)\r\n          .toLocaleDateString(\"lookup\", {\r\n            year: \"numeric\",\r\n            month: \"long\",\r\n            day: \"numeric\",\r\n          })\r\n          .replace(/г.$/g, \"\")\r\n          .trim();\r\n\r\n        $tourTitle.innerHTML = `\r\n      <h2>\r\n        Результаты запроса (${selectedCity} -\r\n        ${selectedCountry},\r\n        ${localDate},\r\n        ${nights}-${nightsTo}н.):\r\n      </h2>\r\n      `;\r\n\r\n        $tourTableHead.innerHTML = `\r\n        <tr>\r\n          <th>Hotel name</th>\r\n          <th>price</th>\r\n          <th>currency</th>\r\n        </tr>\r\n      `;\r\n\r\n        sort.forEach((tour) => {\r\n          $tourTableBody.innerHTML += `\r\n        <tr>\r\n          <td>${tour.hotelName}</td>\r\n          <td>${tour.price}</td>\r\n          <td>${tour.currency}</td>\r\n        </tr>\r\n        `;\r\n\r\n        document.querySelector('#tours').classList.add('tours')\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        throw new Error(`${err.name} ${err.message}`);\r\n      })\r\n      .finally(() => {\r\n        e.target.reset();\r\n        removeErrorClass($nights);\r\n        removeErrorClass($nightsTo);\r\n      });\r\n  });\r\n\r\n  function compareFn(a, b) {\r\n    if (a.price > b.price) {\r\n      return 1;\r\n    }\r\n    if (a.price < b.price) {\r\n      return -1;\r\n    }\r\n    return 0;\r\n  }\r\n\r\n  $departCity.addEventListener(\"change\", (e) => {\r\n    const target = e.target;\r\n    // console.dir(e.target)\r\n    // console.log(e.target.value)\r\n    if (target && $departCity.value === \"10\") {\r\n      $country.innerHTML = `\r\n      <option value=\"\" disabled selected hidden>Страна</option>\r\n      <option value=\"552\">Турция</option>\r\n      <option value=\"553\">Тайланд</option>`;\r\n    } else if (target && $departCity.value === \"11\") {\r\n      $country.innerHTML = `\r\n      <option value=\"\" disabled selected hidden>Страна</option>\r\n      <option value=\"552\">Турция</option>\r\n      <option value=\"554\">Чехия</option>`;\r\n    } else {\r\n      $country.innerHTML = `\r\n      <option value=\"\" disabled selected hidden>Страна</option>\r\n      <option>Страна</option>\r\n      `;\r\n    }\r\n  });\r\n\r\n  function inputAddError(target, message) {\r\n    target.value = \"\";\r\n    target.setAttribute(\"placeholder\", message);\r\n    target.classList.add(\"error\");\r\n  }\r\n\r\n  function removeErrorClass(elem) {\r\n    elem.classList.remove(\"error\");\r\n    elem.setAttribute(\"placeholder\", \"от 5 до 15\");\r\n  }\r\n});\r\n","const maxDate = changeDatePickerRange(90);\r\nconst minDate = changeDatePickerRange(1);\r\n\r\nsetMaxDate(\"date-input\", maxDate);\r\nsetMinDate(\"date-input\", minDate);\r\n\r\n/* ============= functions =============== */\r\n\r\nfunction changeDatePickerRange(days) {\r\n  const millesec = getMillisecunds(days);\r\n  const date = getDate(millesec);\r\n  return date;\r\n}\r\n\r\nfunction getDate(millisec) {\r\n  const t = Date.now() + millisec,\r\n    days = new Date(t).getDate(),\r\n    month = new Date(t).getMonth() + 1,\r\n    year = new Date(t).getFullYear();\r\n\r\n  const date = `${year}-${getZero(month)}-${getZero(days)}`;\r\n\r\n  return date;\r\n}\r\n\r\nfunction getZero(num) {\r\n  if (num >= 0 && num < 10) {\r\n    return \"0\" + num;\r\n  } else {\r\n    return num;\r\n  }\r\n}\r\n\r\nfunction setMaxDate(selector, date) {\r\n  document.getElementById(selector).setAttribute(\"max\", date);\r\n}\r\nfunction setMinDate(selector, date) {\r\n  document.getElementById(selector).setAttribute(\"min\", date);\r\n}\r\n\r\nfunction getMillisecunds(days) {\r\n  const mil = 1000 * 60 * 60 * 24 * days;\r\n  return mil;\r\n}\r\n\r\n// function createNode(element, className, message) {\r\n//   const div = document.createElement(element);\r\n//   div.classList.add(className);\r\n//   div.textContent = message;\r\n//   return div;\r\n// }\r\n\r\n// function append(parent, el) {\r\n//   return parent.append(el);\r\n// }\r\n"]}